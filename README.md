# Proxmox OS Auto-Tagger

Automatically tags Proxmox VE LXC containers and VMs with their OS release version (e.g., "os-ubuntu-24.04-lts" or "os-debian-gnu-linux-13-trixie").

This script scans all running guests (both LXC and QEMU/VM) and uses `/etc/os-release` (for LXC) or the QEMU Guest Agent (for VMs) to determine the OS version. It generates a standardized, all-lowercase tag prefixed with `os-` and applies it, while preserving any other tags you have set.

It is idempotent: if the correct tag already exists, it skips the update. It also cleans up old tags generated by this script (including deprecated "OS-" capitalized versions).

## Requirements

1.  **PVE Host**: Must be run as `root` on the Proxmox VE host node.
2.  **`jq` Package**: The `jq` utility must be installed on the PVE host.
    ```bash
    apt update
    apt install -y jq
    ```
3.  **QEMU VMs**: Target VMs must have the **QEMU Guest Agent** installed, running, and enabled in the Proxmox VM options.
    * *Debian/Ubuntu*: `apt install qemu-guest-agent`
    * *RHEL/Rocky/Alma*: `dnf install qemu-guest-agent`

## Usage

1.  Place the `pve_os_tagger.sh` script on your PVE host (e.g., in `/usr/local/sbin/`).
2.  Make the script executable:
    ```bash
    chmod +x /usr/local/sbin/pve_os_tagger.sh
    ```
3.  Run the script:
    ```bash
    /usr/local/sbin/pve_os_tagger.sh
    ```
